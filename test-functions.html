<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #005a9e;
        }
        
        .test-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        
        .lang-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .lang-btn {
            padding: 8px 16px;
            background: transparent;
            border: 2px solid #007acc;
            color: #007acc;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .lang-btn:hover {
            background: #007acc;
            color: white;
        }
        
        .lang-btn.active {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }
        
        .data-display {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª è‰ºæœ¯å®¶ç½‘ç«™åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
    
    <!-- å¤šè¯­è¨€æµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸŒ å¤šè¯­è¨€åˆ‡æ¢æµ‹è¯•</h2>
        <div class="lang-buttons">
            <button class="lang-btn" data-lang="zh" onclick="testLanguageSwitch('zh')">ä¸­æ–‡</button>
            <button class="lang-btn" data-lang="en" onclick="testLanguageSwitch('en')">English</button>
            <button class="lang-btn" data-lang="ja" onclick="testLanguageSwitch('ja')">æ—¥æœ¬èª</button>
        </div>
        <div>
            <p>æµ‹è¯•æ–‡æœ¬ï¼š<span data-i18n="nav-home" id="test-text">é¦–é¡µ</span></p>
            <p>è‰ºæœ¯å®¶å§“åï¼š<span data-i18n="artist-name" id="test-artist-name">æ—å£«æ—</span></p>
        </div>
        <button class="test-button" onclick="testI18nData()">æ£€æŸ¥å¤šè¯­è¨€æ•°æ®</button>
        <div id="i18n-result" class="test-result"></div>
    </div>
    
    <!-- æ•°æ®ç®¡ç†æµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸ“Š æ•°æ®ç®¡ç†æµ‹è¯•</h2>
        <button class="test-button" onclick="testLocalStorageData()">æ£€æŸ¥æœ¬åœ°å­˜å‚¨æ•°æ®</button>
        <button class="test-button" onclick="testArtworksData()">æ£€æŸ¥ä½œå“æ•°æ®</button>
        <button class="test-button" onclick="testProfileData()">æ£€æŸ¥ä¸ªäººä¿¡æ¯</button>
        <button class="test-button" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
        <div id="data-result" class="test-result"></div>
    </div>
    
    <!-- ä½œå“ç®¡ç†æµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸ–¼ï¸ ä½œå“ç®¡ç†æµ‹è¯•</h2>
        <button class="test-button" onclick="addTestArtwork()">æ·»åŠ æµ‹è¯•ä½œå“</button>
        <button class="test-button" onclick="updateTestArtwork()">æ›´æ–°æµ‹è¯•ä½œå“</button>
        <button class="test-button" onclick="deleteTestArtwork()">åˆ é™¤æµ‹è¯•ä½œå“</button>
        <button class="test-button" onclick="displayArtworks()">æ˜¾ç¤ºæ‰€æœ‰ä½œå“</button>
        <div id="artwork-result" class="test-result"></div>
    </div>
    
    <!-- æ•°æ®åŒæ­¥æµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸ”„ æ•°æ®åŒæ­¥æµ‹è¯•</h2>
        <button class="test-button" onclick="testDataSync()">æ¨¡æ‹Ÿåå°æ•°æ®æ›´æ–°</button>
        <button class="test-button" onclick="startSyncMonitor()">å¼€å§‹åŒæ­¥ç›‘æ§</button>
        <button class="test-button" onclick="stopSyncMonitor()">åœæ­¢åŒæ­¥ç›‘æ§</button>
        <div id="sync-result" class="test-result"></div>
    </div>
    
    <!-- å½“å‰æ•°æ®æŸ¥çœ‹ -->
    <div class="test-section">
        <h2>ğŸ“‹ å½“å‰æ•°æ®çŠ¶æ€</h2>
        <div class="data-display" id="current-data"></div>
        <button class="test-button" onclick="refreshDataDisplay()">åˆ·æ–°æ˜¾ç¤º</button>
    </div>

    <script>
        let syncMonitorInterval = null;
        
        // å¤šè¯­è¨€æµ‹è¯•å‡½æ•°
        function testLanguageSwitch(lang) {
            log('i18n-result', `åˆ‡æ¢åˆ°è¯­è¨€: ${lang}`, 'info');
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                }
            });
            
            // æ£€æŸ¥æ˜¯å¦æœ‰switchLanguageå‡½æ•°
            if (typeof switchLanguage === 'function') {
                try {
                    switchLanguage(lang);
                    log('i18n-result', `è¯­è¨€åˆ‡æ¢æˆåŠŸï¼`, 'success');
                    
                    // æ£€æŸ¥æ–‡æœ¬æ˜¯å¦æ›´æ–°
                    setTimeout(() => {
                        const testText = document.getElementById('test-text').textContent;
                        const artistName = document.getElementById('test-artist-name').textContent;
                        log('i18n-result', `å½“å‰æ˜¾ç¤ºæ–‡æœ¬: "${testText}", è‰ºæœ¯å®¶åç§°: "${artistName}"`, 'info');
                    }, 100);
                } catch (error) {
                    log('i18n-result', `è¯­è¨€åˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('i18n-result', 'é”™è¯¯ï¼šæ‰¾ä¸åˆ° switchLanguage å‡½æ•°ï¼Œéœ€è¦åŠ è½½ i18n.js', 'error');
            }
        }
        
        function testI18nData() {
            const result = [];
            result.push('=== å¤šè¯­è¨€æ•°æ®æ£€æŸ¥ ===');
            
            // æ£€æŸ¥localStorageä¸­çš„i18næ•°æ®
            const storedI18n = localStorage.getItem('i18n_data');
            if (storedI18n) {
                try {
                    const i18nData = JSON.parse(storedI18n);
                    result.push(`âœ“ localStorageä¸­å‘ç°å¤šè¯­è¨€æ•°æ®`);
                    result.push(`æ”¯æŒçš„è¯­è¨€: ${Object.keys(i18nData).join(', ')}`);
                    
                    Object.keys(i18nData).forEach(lang => {
                        const keyCount = Object.keys(i18nData[lang]).length;
                        result.push(`  ${lang}: ${keyCount} ä¸ªç¿»è¯‘é”®`);
                    });
                } catch (error) {
                    result.push(`âœ— localStorageä¸­çš„i18næ•°æ®æ ¼å¼é”™è¯¯: ${error.message}`);
                }
            } else {
                result.push('âš  localStorageä¸­æœªæ‰¾åˆ°å¤šè¯­è¨€æ•°æ®');
            }
            
            // æ£€æŸ¥å…¨å±€i18nå˜é‡
            if (typeof i18n !== 'undefined') {
                result.push(`âœ“ å…¨å±€i18nå˜é‡å­˜åœ¨`);
                result.push(`å½“å‰è¯­è¨€: ${typeof currentLanguage !== 'undefined' ? currentLanguage : 'æœªå®šä¹‰'}`);
            } else {
                result.push('âœ— å…¨å±€i18nå˜é‡ä¸å­˜åœ¨');
            }
            
            document.getElementById('i18n-result').innerHTML = result.join('\\n');
        }
        
        // æ•°æ®ç®¡ç†æµ‹è¯•å‡½æ•°
        function testLocalStorageData() {
            const result = [];
            result.push('=== æœ¬åœ°å­˜å‚¨æ•°æ®æ£€æŸ¥ ===');
            
            const keys = ['profile_data', 'artworks_data', 'i18n_data', 'site_config'];
            keys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        result.push(`âœ“ ${key}: ${JSON.stringify(parsed).length} å­—èŠ‚`);
                    } catch (error) {
                        result.push(`âœ— ${key}: æ•°æ®æ ¼å¼é”™è¯¯`);
                    }
                } else {
                    result.push(`âš  ${key}: æ•°æ®ä¸å­˜åœ¨`);
                }
            });
            
            log('data-result', result.join('\\n'));
        }
        
        function testArtworksData() {
            const artworksData = localStorage.getItem('artworks_data');
            if (artworksData) {
                try {
                    const artworks = JSON.parse(artworksData);
                    log('data-result', `ä½œå“æ•°æ®: å…± ${artworks.length} ä»¶ä½œå“\\n${JSON.stringify(artworks, null, 2)}`, 'info');
                } catch (error) {
                    log('data-result', `ä½œå“æ•°æ®è§£æé”™è¯¯: ${error.message}`, 'error');
                }
            } else {
                log('data-result', 'æœªæ‰¾åˆ°ä½œå“æ•°æ®', 'error');
            }
        }
        
        function testProfileData() {
            const profileData = localStorage.getItem('profile_data');
            if (profileData) {
                try {
                    const profile = JSON.parse(profileData);
                    log('data-result', `ä¸ªäººä¿¡æ¯æ•°æ®:\\n${JSON.stringify(profile, null, 2)}`, 'info');
                } catch (error) {
                    log('data-result', `ä¸ªäººä¿¡æ¯è§£æé”™è¯¯: ${error.message}`, 'error');
                }
            } else {
                log('data-result', 'æœªæ‰¾åˆ°ä¸ªäººä¿¡æ¯æ•°æ®', 'error');
            }
        }
        
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æœ¬åœ°å­˜å‚¨æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ä¸ªäººä¿¡æ¯å’Œä½œå“æ•°æ®ï¼')) {
                localStorage.clear();
                log('data-result', 'æ‰€æœ‰æœ¬åœ°å­˜å‚¨æ•°æ®å·²æ¸…ç©º', 'success');
                refreshDataDisplay();
            }
        }
        
        // ä½œå“ç®¡ç†æµ‹è¯•å‡½æ•°
        function addTestArtwork() {
            const testArtwork = {
                id: Date.now(),
                titleKey: `test-artwork-${Date.now()}`,
                descriptionKey: `test-desc-${Date.now()}`,
                category: "digital",
                image: "https://via.placeholder.com/400x300/007acc/white?text=Test+Artwork",
                details: {
                    medium: "æ•°å­—è‰ºæœ¯",
                    size: "1920Ã—1080",
                    year: "2025"
                }
            };
            
            // è·å–ç°æœ‰ä½œå“æ•°æ®
            let artworks = [];
            const existingData = localStorage.getItem('artworks_data');
            if (existingData) {
                artworks = JSON.parse(existingData);
            }
            
            artworks.push(testArtwork);
            localStorage.setItem('artworks_data', JSON.stringify(artworks));
            
            // æ·»åŠ å¤šè¯­è¨€æ•°æ®
            let i18nData = {};
            const existingI18n = localStorage.getItem('i18n_data');
            if (existingI18n) {
                i18nData = JSON.parse(existingI18n);
            } else {
                i18nData = { zh: {}, en: {}, ja: {} };
            }
            
            i18nData.zh[testArtwork.titleKey] = `æµ‹è¯•ä½œå“ ${testArtwork.id}`;
            i18nData.en[testArtwork.titleKey] = `Test Artwork ${testArtwork.id}`;
            i18nData.ja[testArtwork.titleKey] = `ãƒ†ã‚¹ãƒˆä½œå“ ${testArtwork.id}`;
            
            i18nData.zh[testArtwork.descriptionKey] = `è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ä½œå“çš„æè¿°`;
            i18nData.en[testArtwork.descriptionKey] = `This is a test artwork description`;
            i18nData.ja[testArtwork.descriptionKey] = `ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆä½œå“ã®èª¬æ˜ã§ã™`;
            
            localStorage.setItem('i18n_data', JSON.stringify(i18nData));
            
            log('artwork-result', `æµ‹è¯•ä½œå“æ·»åŠ æˆåŠŸï¼ID: ${testArtwork.id}`, 'success');
        }
        
        function updateTestArtwork() {
            let artworks = [];
            const existingData = localStorage.getItem('artworks_data');
            if (existingData) {
                artworks = JSON.parse(existingData);
            }
            
            if (artworks.length === 0) {
                log('artwork-result', 'æ²¡æœ‰ä½œå“å¯ä»¥æ›´æ–°', 'error');
                return;
            }
            
            // æ›´æ–°ç¬¬ä¸€ä¸ªä½œå“
            artworks[0].details.year = "2025 (å·²æ›´æ–°)";
            localStorage.setItem('artworks_data', JSON.stringify(artworks));
            
            log('artwork-result', `ä½œå“æ›´æ–°æˆåŠŸï¼æ›´æ–°äº†ä½œå“ ID: ${artworks[0].id}`, 'success');
        }
        
        function deleteTestArtwork() {
            let artworks = [];
            const existingData = localStorage.getItem('artworks_data');
            if (existingData) {
                artworks = JSON.parse(existingData);
            }
            
            if (artworks.length === 0) {
                log('artwork-result', 'æ²¡æœ‰ä½œå“å¯ä»¥åˆ é™¤', 'error');
                return;
            }
            
            const deletedArtwork = artworks.pop();
            localStorage.setItem('artworks_data', JSON.stringify(artworks));
            
            log('artwork-result', `ä½œå“åˆ é™¤æˆåŠŸï¼åˆ é™¤äº†ä½œå“ ID: ${deletedArtwork.id}`, 'success');
        }
        
        function displayArtworks() {
            const artworksData = localStorage.getItem('artworks_data');
            if (artworksData) {
                try {
                    const artworks = JSON.parse(artworksData);
                    const result = artworks.map(artwork => 
                        `ID: ${artwork.id}, æ ‡é¢˜é”®: ${artwork.titleKey}, åˆ†ç±»: ${artwork.category}`
                    ).join('\\n');
                    log('artwork-result', `å½“å‰ä½œå“åˆ—è¡¨ (${artworks.length} ä»¶):\\n${result}`, 'info');
                } catch (error) {
                    log('artwork-result', `æ˜¾ç¤ºä½œå“æ—¶å‡ºé”™: ${error.message}`, 'error');
                }
            } else {
                log('artwork-result', 'æ²¡æœ‰æ‰¾åˆ°ä½œå“æ•°æ®', 'error');
            }
        }
        
        // æ•°æ®åŒæ­¥æµ‹è¯•
        function testDataSync() {
            log('sync-result', 'æ¨¡æ‹Ÿåå°æ•°æ®æ›´æ–°...', 'info');
            
            // æ¨¡æ‹Ÿä¿®æ”¹æ•°æ®
            const timestamp = Date.now();
            localStorage.setItem('test_sync_data', timestamp);
            
            // è§¦å‘storageäº‹ä»¶
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'artworks_data',
                newValue: localStorage.getItem('artworks_data'),
                oldValue: null,
                storageArea: localStorage,
                url: window.location.href
            }));
            
            log('sync-result', `æ•°æ®åŒæ­¥è§¦å‘å®Œæˆï¼Œæ—¶é—´æˆ³: ${timestamp}`, 'success');
        }
        
        function startSyncMonitor() {
            if (syncMonitorInterval) {
                log('sync-result', 'åŒæ­¥ç›‘æ§å·²ç»åœ¨è¿è¡Œä¸­', 'error');
                return;
            }
            
            log('sync-result', 'å¼€å§‹ç›‘æ§æ•°æ®åŒæ­¥...', 'info');
            
            syncMonitorInterval = setInterval(() => {
                const now = new Date().toLocaleTimeString();
                log('sync-result', `[${now}] ç›‘æ§ä¸­... æ£€æŸ¥localStorageå˜åŒ–`, 'info');
            }, 2000);
        }
        
        function stopSyncMonitor() {
            if (syncMonitorInterval) {
                clearInterval(syncMonitorInterval);
                syncMonitorInterval = null;
                log('sync-result', 'å·²åœæ­¢åŒæ­¥ç›‘æ§', 'success');
            } else {
                log('sync-result', 'åŒæ­¥ç›‘æ§æœªè¿è¡Œ', 'error');
            }
        }
        
        // æ•°æ®æ˜¾ç¤º
        function refreshDataDisplay() {
            const dataDisplay = document.getElementById('current-data');
            const currentData = {
                profile_data: getLocalStorageData('profile_data'),
                artworks_data: getLocalStorageData('artworks_data'),
                i18n_data: getLocalStorageData('i18n_data'),
                site_config: getLocalStorageData('site_config')
            };
            
            dataDisplay.textContent = JSON.stringify(currentData, null, 2);
        }
        
        function getLocalStorageData(key) {
            const data = localStorage.getItem(key);
            if (data) {
                try {
                    return JSON.parse(data);
                } catch (error) {
                    return `æ•°æ®è§£æé”™è¯¯: ${error.message}`;
                }
            }
            return null;
        }
        
        // é€šç”¨æ—¥å¿—å‡½æ•°
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            element.innerHTML = `<span class="${colorClass}">[${timestamp}] ${message}</span>`;
        }
        
        // ç›‘å¬localStorageå˜åŒ–
        window.addEventListener('storage', function(e) {
            log('sync-result', `æ£€æµ‹åˆ°localStorageå˜åŒ–: ${e.key}`, 'success');
            refreshDataDisplay();
        });
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾…ä¸€ä¸‹ç¡®ä¿å¤–éƒ¨è„šæœ¬åŠ è½½å®Œæˆ
            setTimeout(() => {
                refreshDataDisplay();
                // æ£€æŸ¥è„šæœ¬æ˜¯å¦åŠ è½½æˆåŠŸ
                checkScriptLoading();
            }, 500);
        });
        
        // æ£€æŸ¥è„šæœ¬åŠ è½½çŠ¶æ€
        function checkScriptLoading() {
            const statusMessages = [];
            
            if (typeof switchLanguage === 'function') {
                statusMessages.push('âœ… i18n.js åŠ è½½æˆåŠŸ');
            } else {
                statusMessages.push('âŒ i18n.js åŠ è½½å¤±è´¥');
            }
            
            if (typeof getArtworksData === 'function') {
                statusMessages.push('âœ… main.js åŠ è½½æˆåŠŸ');
            } else {
                statusMessages.push('âŒ main.js åŠ è½½å¤±è´¥');
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const statusElement = document.getElementById('i18n-result');
            if (statusElement) {
                statusElement.innerHTML = statusMessages.join('\\n') + '\\n\\nç‚¹å‡»"æ£€æŸ¥å¤šè¯­è¨€æ•°æ®"æŒ‰é’®æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯';
            }
        }
    </script>
    
    <!-- åŠ è½½åŸæœ‰çš„JavaScriptæ–‡ä»¶æ¥æµ‹è¯•åŠŸèƒ½ -->
    <script src="./js/i18n.js" onload="console.log('i18n.js åŠ è½½å®Œæˆ')" onerror="console.error('i18n.js åŠ è½½å¤±è´¥')"></script>
    <script src="./js/main.js" onload="console.log('main.js åŠ è½½å®Œæˆ')" onerror="console.error('main.js åŠ è½½å¤±è´¥')"></script>
</body>
</html>