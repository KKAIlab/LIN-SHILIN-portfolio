<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语言切换调试测试</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5; 
        }
        .test-section { 
            background: white; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .lang-btn { 
            background: #007acc; 
            color: white; 
            border: none; 
            padding: 8px 16px; 
            margin: 5px; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .lang-btn.active { 
            background: #ff6b6b; 
        }
        .lang-btn:hover { 
            background: #005a9e; 
        }
        .test-element { 
            margin: 10px 0; 
            padding: 10px; 
            background: #f0f8ff; 
            border-left: 4px solid #007acc; 
        }
        .debug-info { 
            background: #333; 
            color: #00ff00; 
            padding: 10px; 
            border-radius: 5px; 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            white-space: pre-wrap; 
        }
    </style>
</head>
<body>
    <h1>🔍 语言切换调试测试</h1>
    
    <div class="test-section">
        <h2>语言按钮</h2>
        <button class="lang-btn active" data-lang="zh" onclick="testLanguageSwitch('zh')">中文</button>
        <button class="lang-btn" data-lang="en" onclick="testLanguageSwitch('en')">English</button>
        <button class="lang-btn" data-lang="ja" onclick="testLanguageSwitch('ja')">日本語</button>
    </div>
    
    <div class="test-section">
        <h2>多语言测试元素</h2>
        <div class="test-element">
            <strong>标题：</strong><span data-i18n="hero-line1">创造</span>
        </div>
        <div class="test-element">
            <strong>副标题：</strong><span data-i18n="hero-subtitle">探索色彩与形态的无限可能</span>
        </div>
        <div class="test-element">
            <strong>导航：</strong><span data-i18n="nav-home">首页</span> | <span data-i18n="nav-about">关于</span> | <span data-i18n="nav-gallery">作品</span>
        </div>
        <div class="test-element">
            <strong>艺术家：</strong><span data-i18n="artist-name">林士林</span>
        </div>
    </div>
    
    <div class="test-section">
        <h2>调试信息</h2>
        <div id="debug-output" class="debug-info">等待调试信息...</div>
    </div>
    
    <div class="test-section">
        <h2>手动测试</h2>
        <button onclick="manualTest()">手动测试语言切换</button>
        <button onclick="checkStatus()">检查当前状态</button>
        <button onclick="clearDebug()">清空调试</button>
    </div>

    <!-- 引入关键脚本 -->
    <script src="./js/debug-monitor.js"></script>
    <script src="./js/i18n.js"></script>
    
    <script>
        let debugOutput = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            debugOutput.push(logMessage);
            document.getElementById('debug-output').textContent = debugOutput.join('\n');
            console.log(logMessage);
        }
        
        function testLanguageSwitch(lang) {
            log(`🔄 测试切换到语言: ${lang}`);
            
            // 更新按钮状态
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                }
            });
            
            // 检查switchLanguage函数是否存在
            if (typeof window.switchLanguage === 'function') {
                log(`✅ 找到switchLanguage函数，开始切换到${lang}`);
                try {
                    window.switchLanguage(lang);
                    
                    // 验证切换结果
                    setTimeout(() => {
                        const currentLang = window.currentLanguage;
                        const testElement = document.querySelector('[data-i18n="hero-line1"]');
                        const testText = testElement ? testElement.textContent : '未找到';
                        
                        log(`📊 切换结果：预期${lang}，实际${currentLang}，测试文本："${testText}"`);
                        
                        if (currentLang === lang) {
                            log(`🎉 语言切换成功！`);
                        } else {
                            log(`❌ 语言切换失败`);
                        }
                    }, 1000);
                } catch (error) {
                    log(`❌ 语言切换出错: ${error.message}`);
                }
            } else {
                log(`❌ 未找到switchLanguage函数`);
                log(`可用的全局函数: ${Object.keys(window).filter(k => k.includes('switch') || k.includes('Language') || k.includes('i18n')).join(', ')}`);
            }
        }
        
        function manualTest() {
            log(`🧪 开始手动测试...`);
            log(`当前页面语言: ${document.documentElement.lang}`);
            log(`localStorage中的语言: ${localStorage.getItem('preferredLanguage')}`);
            log(`window.currentLanguage: ${window.currentLanguage}`);
            log(`多语言元素数量: ${document.querySelectorAll('[data-i18n]').length}`);
            log(`语言按钮数量: ${document.querySelectorAll('.lang-btn').length}`);
            
            // 测试数据是否加载
            if (typeof window.i18nData !== 'undefined') {
                log(`✅ i18nData已加载，支持语言: ${Object.keys(window.i18nData).join(', ')}`);
            } else if (typeof i18n !== 'undefined') {
                log(`✅ i18n已加载，支持语言: ${Object.keys(i18n).join(', ')}`);
            } else {
                log(`❌ 多语言数据未加载`);
            }
        }
        
        function checkStatus() {
            log(`📋 当前状态检查:`);
            
            const activeBtn = document.querySelector('.lang-btn.active');
            const activeLang = activeBtn ? activeBtn.getAttribute('data-lang') : '无';
            log(`活动语言按钮: ${activeLang}`);
            
            const testElements = document.querySelectorAll('[data-i18n]');
            testElements.forEach((el, index) => {
                const key = el.getAttribute('data-i18n');
                const text = el.textContent;
                const isProtected = el.getAttribute('data-profile-updated') === 'true';
                log(`[${index}] ${key}: "${text}" (保护: ${isProtected})`);
            });
        }
        
        function clearDebug() {
            debugOutput = [];
            document.getElementById('debug-output').textContent = '调试信息已清空';
        }
        
        // 页面加载完成后自动测试
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                log(`📱 页面加载完成，开始自动检查`);
                manualTest();
            }, 1000);
        });
        
        // 监听语言切换事件
        if (typeof window.debugMonitor !== 'undefined') {
            log(`✅ 调试监控系统已加载`);
        }
        
        // 5秒后自动测试语言切换
        setTimeout(() => {
            log(`⏰ 自动测试：5秒后切换到英语`);
            testLanguageSwitch('en');
        }, 5000);
    </script>
</body>
</html>